<?xml version="1.0" encoding="utf-8"?>
<Macro id="M809E42D36C9642F59329983D02BA66DF" name="Highlight" category="Text" description="Extracts any highlighted text and prints it at the end of the page" version="40">
  <Metadata lastModifiedDate="2024-10-31T07:16:44.000Z" />
  <Expression>$scope = "Current Page"</Expression>
  <Comment text="Decide the scope" />
  <Expression>$includePath = false</Expression>
  <Expression>$curPage = true</Expression>
  <Expression>$scopeObj = GetCurrentPage()</Expression>
  <Comment text="Collect info for all the pages in the scope" />
  <Expression>$Paragraphs = Array()</Expression>
  <Expression>$sectionPaths = Array()</Expression>
  <Expression>$Page = GetCurrentPage()</Expression>
  <ForEach var="p">
    <Array>QueryObjects("Paragraph", $Page)</Array>
    <Expression>$link = ""</Expression>
    <ForEach var="t">
      <Array>$p.texts</Array>
      <If>
        <Condition>($t.value == "") || ($t.highlightColor == "automatic") || ($t.highlightColor != "#ffff00")</Condition>
        <Continue>1</Continue>
      </If>
      <If>
        <Condition>$link == ""</Condition>
        <Expression>$link = $p.hyperlink</Expression>
        <If>
          <Condition>$link == ""</Condition>
          <Expression>$link = $Page.hyperlink</Expression>
        </If>
      </If>
      <Expression>Array_PushBack($Texts, Array($t, $link))</Expression>
    </ForEach>
  </ForEach>
  <Comment text="If we haven't found any, we are done" />
  <If>
    <Condition>Array_Length($Texts) == 0</Condition>
    <Expression>DialogBox_Show(DialogBox_Create("No highlighted text found in " &amp; $scope))</Expression>
    <Expression>ExitMacro(false)</Expression>
  </If>
  <ForEach var="value">
    <Array>$Texts</Array>
    <Comment text="Create a new page" />
    <Expression>$Page = InsertObject(GetCurrentSection(), "Page", -1)</Expression>
    <Comment text="Set the page title" />
    <Expression>$Page.title.paragraph.text = $value[0].value + " "</Expression>
    <Expression>$Text = InsertObject($Page.title.paragraph, "Text", -1)</Expression>
    <Expression>$Text.value = "(Go back)"</Expression>
    <Expression>$Text.hyperlink = $value[1]</Expression>
    <Comment text="Create page content" />
    <Expression>$Outline = InsertObject($Page, "Outline", -1)</Expression>
    <Expression>$Paragraph = InsertObject($Outline, "Paragraph", -1)</Expression>
    <Expression>$Paragraph.text = "




"</Expression>
    <Expression>$value[0].hyperlink = $Page.hyperlink</Expression>
  </ForEach>
</Macro>